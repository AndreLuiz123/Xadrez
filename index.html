<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de tiro</title>
    <script src="Grid.js"></script>
    <script src="Sprite.js"></script>
    <script src="Rei.js"></script>
    <script src="Torre.js"></script>
    <script src="Bispo.js"></script>
</head>
<body>
    
    <canvas></canvas>
    
    <script>
    
        var canvas = document.querySelector("canvas");
        canvas.width = 500;
        canvas.height = 500;
        
        var dt = 0;
        var anterior = 0;
        var ctx = canvas.getContext("2d");

        var tabuleiro = new Tabuleiro(8,8,canvas);
        var peao = new Sprite(1,1, tabuleiro);
        var peao2 = new Sprite(1,2, tabuleiro,0);
        var rei = new Rei(2,2, tabuleiro);
        var torre = new Torre(2,3, tabuleiro);
        var bispo = new Bispo(2,4, tabuleiro);


        function passo(t)//Main loop
        {
            dt = (t - anterior)/1000;

            ctx.strokeStyle = "black";
            ctx.strokeRect(0,0,canvas.width, canvas.height);

            ctx.fillStyle = "white";
            ctx.fillRect(0,0,canvas.width, canvas.height);

            tabuleiro.desenhar(ctx);
            peao.desenhar(ctx);
            peao2.desenhar(ctx);

            rei.desenhar(ctx);
            torre.desenhar(ctx);
            bispo.desenhar(ctx);

            anterior = t;
            requestAnimationFrame(passo);
        }

        canvas.onmousedown = mydown;
        canvas.onmouseup = myup;

        function mydown(e){
          if(e.pageX<=bispo.x +bispo.w && e.pageX>bispo.x && e.pageY<=bispo.y +bispo.h && e.pageY>=bispo.y)
            canvas.onmousemove = mymove;
        }

        function mymove(e){    
          bispo.x = e.pageX -bispo.w/2;
          bispo.y = e.pageY -bispo.h/2;
        }

        function myup(e){
           if(canvas.onmousemove)
           {
               canvas.onmousemove = null;
               if(bispo.verificaValidadeCasa(bispo.calculaLetra(bispo.x+bispo.w/2),bispo.calculaNumero(bispo.y +bispo.h/2)))
                 bispo.reposicionaPeca();
               else
                 bispo.voltaPecaLocalOriginal(); 
               

           }

        }

        requestAnimationFrame(passo);

    </script>
</body>
</html>