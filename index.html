<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xadrez</title>
    <script src="Grid.js"></script>
    <script src="Sprite.js"></script>
    <script src="Rei.js"></script>
    <script src="Torre.js"></script>
    <script src="Bispo.js"></script>
    <script src="Rainha.js"></script>
    <script src="Cavalo.js"></script>
</head>
<body>
    
    <canvas></canvas>
    
    <script>
    
        var canvas = document.querySelector("canvas");
        canvas.width = 500;
        canvas.height = 500;
        
        var dt = 0;
        var anterior = 0;
        var ctx = canvas.getContext("2d");

        var tabuleiro = new Tabuleiro(8,8,canvas);
        var peao = new Sprite(1,1, tabuleiro);
        var peao2 = new Sprite(1,2, tabuleiro,0);
        var rei = new Rei(2,2, tabuleiro);
        var torre = new Torre(2,3, tabuleiro);
        var bispo = new Bispo(2,4, tabuleiro);
        var rainha = new Rainha(2,5,tabuleiro);
        var cavalo = new Cavalo(2,6,tabuleiro,0);

        tabuleiro.criaGrid();

        function passo(t)//Main loop
        {
            dt = (t - anterior)/1000;

            ctx.strokeStyle = "black";
            ctx.strokeRect(0,0,canvas.width, canvas.height);

            ctx.fillStyle = "white";
            ctx.fillRect(0,0,canvas.width, canvas.height);

            tabuleiro.desenhar(ctx);
            peao.desenhar(ctx);
            peao2.desenhar(ctx);

            rei.desenhar(ctx);
            torre.desenhar(ctx);
            bispo.desenhar(ctx);
            rainha.desenhar(ctx);
            cavalo.desenhar(ctx);

            anterior = t;
            requestAnimationFrame(passo);
        }

        canvas.onmousedown = mydown;
        canvas.onmouseup = myup;

        function mydown(e){
          if(e.pageX<=cavalo.x +cavalo.w && e.pageX>cavalo.x && e.pageY<=cavalo.y +cavalo.h && e.pageY>=cavalo.y)
          {
            canvas.onmousemove = mymove;
            tabuleiro.mudaStatusCasa(cavalo.letra,cavalo.numero,0);
          }
        }

        function mymove(e){    
          cavalo.x = e.pageX -cavalo.w/2;
          cavalo.y = e.pageY -cavalo.h/2;
        }

        function myup(e){
           if(canvas.onmousemove)
           {
               canvas.onmousemove = null;
               if(cavalo.verificaValidadeCasa(cavalo.calculaLetra(cavalo.x+cavalo.w/2),cavalo.calculaNumero(cavalo.y +cavalo.h/2))
                && tabuleiro.grid[cavalo.calculaLetra(cavalo.x+cavalo.w/2)][cavalo.calculaNumero(cavalo.y +cavalo.h/2)]===0) 
                   cavalo.reposicionaPeca();
               else
                 cavalo.voltaPecaLocalOriginal(); 
           
               tabuleiro.mudaStatusCasa(cavalo.letra,cavalo.numero,1);          

           }

        }

        requestAnimationFrame(passo);

    </script>
</body>
</html>