<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de tiro</title>
    <script src="Grid.js"></script>
    <script src="Sprite.js"></script>
    <script src="Rei.js"></script>
    <script src="Torre.js"></script>
    <script src="Bispo.js"></script>
    <script src="Rainha.js"></script>
</head>
<body>
    
    <canvas></canvas>
    
    <script>
    
        var canvas = document.querySelector("canvas");
        canvas.width = 500;
        canvas.height = 500;
        
        var dt = 0;
        var anterior = 0;
        var ctx = canvas.getContext("2d");

        var tabuleiro = new Tabuleiro(8,8,canvas);
        var peao = new Sprite(1,1, tabuleiro);
        var peao2 = new Sprite(1,2, tabuleiro,0);
        var rei = new Rei(2,2, tabuleiro);
        var torre = new Torre(2,3, tabuleiro);
        var bispo = new Bispo(2,4, tabuleiro);
        var rainha = new Rainha(2,5,tabuleiro);

        function passo(t)//Main loop
        {
            dt = (t - anterior)/1000;

            ctx.strokeStyle = "black";
            ctx.strokeRect(0,0,canvas.width, canvas.height);

            ctx.fillStyle = "white";
            ctx.fillRect(0,0,canvas.width, canvas.height);

            tabuleiro.desenhar(ctx);
            peao.desenhar(ctx);
            peao2.desenhar(ctx);

            rei.desenhar(ctx);
            torre.desenhar(ctx);
            bispo.desenhar(ctx);
            rainha.desenhar(ctx);

            anterior = t;
            requestAnimationFrame(passo);
        }

        canvas.onmousedown = mydown;
        canvas.onmouseup = myup;

        function mydown(e){
          if(e.pageX<=rainha.x +rainha.w && e.pageX>rainha.x && e.pageY<=rainha.y +rainha.h && e.pageY>=rainha.y)
            canvas.onmousemove = mymove;
        }

        function mymove(e){    
          rainha.x = e.pageX -rainha.w/2;
          rainha.y = e.pageY -rainha.h/2;
        }

        function myup(e){
           if(canvas.onmousemove)
           {
               canvas.onmousemove = null;
               if(rainha.verificaValidadeCasa(rainha.calculaLetra(rainha.x+rainha.w/2),rainha.calculaNumero(rainha.y +rainha.h/2)))
                 rainha.reposicionaPeca();
               else
                 rainha.voltaPecaLocalOriginal(); 
               

           }

        }

        requestAnimationFrame(passo);

    </script>
</body>
</html>